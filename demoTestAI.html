
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>E-Ra Widget Control</title>
    <script src="https://www.unpkg.com/@eohjsc/era-widget@1.1.3/src/index.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #1e1e1e;
        color: #ffffff;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
      }
      .control-container {
        background: rgba(255, 255, 255, 0.1);
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        text-align: center;
      }
      .control-button {
        background: linear-gradient(45deg, #ff6b6b, #ffa5a5);
        border: none;
        color: white;
        padding: 15px 30px;
        font-size: 16px;
        border-radius: 5px;
        cursor: pointer;
        transition: background 0.3s ease;
      }
      .control-button:hover {
        background: linear-gradient(45deg, #ff4b4b, #ff8b8b);
      }
      .control-button.active {
        background: linear-gradient(45deg, #4caf50, #8bc34a);
      }
      .control-button:disabled {
        background: #cccccc;
        cursor: not-allowed;
      }
    </style>
  </head>
  <body>
    <div class="control-container">
      <button id="control-0" class="control-button" onclick="toggleControl(0)">
        Turn On
      </button>
    </div>

    <script>
      const eraWidget = new EraWidget();
      let actionConfigs = new Array(1).fill(null);
      let isConfigured = false;

      eraWidget.init({
        onConfiguration: (configuration) => {
          console.log("E-Ra Configuration received:", configuration);
          if (configuration.actions && configuration.actions[0]) {
            actionConfigs[0] = configuration.actions[0];
          }
          isConfigured = true;
        },
        onValues: (values) => {
          console.log("E-Ra Values received:", values);
        },
      });

      function toggleControl(controlIndex) {
        if (!isConfigured) {
          console.warn("E-Ra chưa được cấu hình. Vui lòng đợi...");
          return;
        }

        const controlElement = document.getElementById(
          `control-${controlIndex}`
        );
        const isActive = controlElement.classList.contains("active");
        controlDevice(controlIndex, !isActive);
      }

      function controlDevice(actionIndex, isOn) {
        if (!isConfigured) {
          console.warn("E-Ra chưa được cấu hình. Vui lòng đợi...");
          return;
        }

        if (actionConfigs[actionIndex] && actionConfigs[actionIndex].action) {
          const value = isOn ? 1 : 0;
          console.log(`Controlling device ${actionIndex}: ${value}`);
          eraWidget.triggerAction(actionConfigs[actionIndex].action, null, {
            value: value,
          });
          updateControlState(actionIndex, isOn);
        } else {
          console.error(
            `Action config ${actionIndex} chưa được thiết lập đúng`
          );
        }
      }

      function updateControlState(controlIndex, value) {
        const controlElement = document.getElementById(
          `control-${controlIndex}`
        );
        if (controlElement) {
          controlElement.classList.toggle("active", value > 0);
          controlElement.textContent = value > 0 ? "Turn Off" : "Turn On";
        }
      }
    </script>
  </body>
</html>
